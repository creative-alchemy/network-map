<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css' rel='stylesheet' />
<style>
#map {
  position: absolute;
}

#controls {
  pointer-events: none;
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100%;
  height: 100vh;
}

#label-and-geocoder {
  align-items: center;
  display: flex;
  margin: 0px 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

#map-title {
  align-items: center;
  background: rgba(255, 96, 29, 0.3);
  display: inline-flex;
  padding: 5px 20px;
  margin-right: 20px;
  margin-bottom: 20px;
}

#map-title svg {
  margin-right: 20px;
}

#map-title h1 {
  font-size: 30px;
  margin-bottom: 0px;
}

.geocoder-container {
  align-items: center;
  display: flex;
  margin-bottom: 20px;
}

#geocoder {
  width: 300px;
  margin-right: 20px;
}

#filters {
  display: none;
}
#geocoder .mapboxgl-ctrl-geocoder {
  width: initial;
}

#map-legend {
  background-color: white;
  display: inline-block;
  opacity: 0.8;
  padding: 20px;
  margin: 0 20px;
  margin-bottom: 20px;
}

#map-legend__preparation-program {
  display: inline-flex;
  align-items: center;
}

#map-legend__preparation-program #preparation-program__icon {
  border-radius: 100%;
  height: 15px;
  width: 15px;
  background-color: rgb(255, 96, 29);
}

#map-legend__school {
  display: inline-flex;
  align-items: center;
}

#map-legend__school #school__icon {
  background-color: #c31fff;
  height: 15px;
  margin-left: 20px;
  width: 15px;
}

#map-legend__school span {
  margin-left: 5px;
}

#map-legend__preparation-program span {
  margin-left: 5px;
}

#click-hint {
  font-size: 12px;
}

#filter-explanations {
  background-color: white;
  bottom: 20px;
  font-family: Arial;
  left: 418px;
  opacity: 0.8;
  padding: 20px;
  position: absolute;
  scrollbar-width: none;
  margin-right: 50px;
}

#filter-results-by {
  pointer-events: all;
  background-color: white;
  font-family: Arial;
  opacity: 0.8;
  overflow-y: scroll;
  margin: 0 20px;
  padding: 20px;
  scrollbar-width: none;
  width: 377px;
  height: calc(100% - 210px);
}

#filter-results-by:hover {
  scrollbar-width: auto;
}

#filter-results-by__title {
  margin-bottom: 10px;
}

#filter-results-by #filter-results-by__close {
  display: none;
}

.sub-contents {
  padding-left: 20px;
}

.collapse-toggle, .collapse-toggle:hover {
  color: rgb(33, 37, 41);
  text-decoration: none;
}

/* Mapbox tweaks */
.mapboxgl-popup-content {
  max-width: 320px;
  padding: 15px;
  width: 100vw;
}

.mapboxgl-popup-content h5:last-child {
  margin-bottom: 0px;
}

/* Markers */
.marker {
  border: 2px solid white;
  cursor: pointer;
  width: 15px;
  height: 15px;
  -webkit-box-shadow: 0px 0px 2px 2px rgba(0,0,0,0.05);
  -moz-box-shadow: 0px 0px 2px 2px rgba(0,0,0,0.05);
  box-shadow: 0px 0px 2px 2px rgba(0,0,0,0.05);
}

.marker:hover {
  border: 4px solid white;
  width: 30px;
  height: 30px;
}

.marker__preparation-program {
  background-color: rgb(255, 96, 29);
  border-radius: 100%;
}

.marker__school {
  background-color: #c31fff;
}

.marker:active {
  outline: none;
  border: none;
}

@media only screen and (max-width: 1024px) {
  #filters {
    pointer-events: all;
    align-items: center;
    background-color: #1565c0;
    border-radius: 2px;
    color: white;
    cursor: pointer;
    display: flex;
    font-size: 12px;
    height: 40px;
    justify-content: center;
    width: 30%;
  }

  #filter-results-by {
    display: none;
  }

  #filter-results-by {
    bottom: 0px;
    display: none;
    left: 0px;
    opacity: 1;
    position: absolute;
    margin: 0px;
    top: 0px;
    height: 100%;
    width: 100%;
    z-index: 2;
  }

  #filter-results-by #filter-results-by__close {
    display: block;
    position: absolute;
    height: 15px;
    width: 15px;
    top: 20px;
    right: 20px;
  }

  #filter-explanations {
    display: block;
    font-size: 12px;
    left: 20px;
    padding: 10px;
    width: calc(100% - 40px);
  }
}

@media only screen and (max-width: 650px) {
  .container {
    font-size: 12px;
  }

  #label-and-geocoder {
    margin: 0px;
  }

  #map-title {
    background: rgba(255, 96, 29, 0.3);
    font-size: 10px;
    left: 0px;
    padding: 5px 5px;
    position: absolute;
    top: 0px;
    width: 100%;
  }

  #map-title h1 {
    font-size: 10px;
  }

  .geocoder-container {
    display: flex;
    justify-content: space-between;
    margin-top: 50px;
    margin-bottom: 10px;
    padding-left: 5px;
    padding-right: 5px;
    width: 100%;
  }

  #geocoder {
    left: 5px;
    margin-right: 5px;
    width: 100%;
  }

  #geocoder .mapboxgl-ctrl-geocoder {
    width: 100%;
  }

  #geocoder .mapboxgl-ctrl-geocoder--icon {
    top: 10px;
  }

  #geocoder .mapboxgl-ctrl-geocoder--input {
    font-size: 13px;
    height: 40px;
    width: 100%;
  }

  #map-legend {
    align-items: center;
    display: flex;
    flex-direction: column;
    font-size: 12px;
    left: 0px;
    margin: 0px;
    padding: 10px;
    top: 75px;
    width: 100%;
  }

  #map-legend .map-legend__icons {
    display: flex;
  }

  #map-legend__preparation-program #preparation-program__icon {
    height: 12px;
    width: 12px;
  }

  #map-legend__school #school__icon {
    height: 12px;
    width: 12px;
  }

  #map-legend #click-hint {
    font-size: 10px;
    margin-top: 5px;
  }
}

@media only screen and (max-width: 300px) {
  #map-legend .map-legend__icons {
    font-size: 10px;
  }
}
</style>
  <!-- CSS only -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <!-- JS, Popper.js, and jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
  <link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
    type="text/css"
  />
  <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.4.1/dist/fetch.umd.min.js" ></script>
  <style>
    body {
      margin: 0px;
      padding: 0px;
    }
  </style>
  </head>
    <body>
      <div id="map" style="width: 100%; height: 100vh;">
      </div>
      <div id="controls">
        <div id="label-and-geocoder">
          <div id="map-title">

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="74px" height="30px" viewBox="0 0 738 301">
<g enable-background="new">
<g id="Layer-1" data-name="Layer 1">
<path transform="matrix(1,0,0,-1,0,301)" d="M 182.345 78.453 L 59.352006 78.453 L 59.352006 259.938 L 182.345 259.938 Z " fill="#f05033"></path>
<clipPath id="cp0">
<path transform="matrix(1,0,0,-1,0,301)" d="M 0 0 L 738 0 L 738 301 L 0 301 Z "></path>
</clipPath>
<g clip-path="url(#cp0)">
<path transform="matrix(1,0,0,-1,149.9253,171.7656)" d="M 0 0 C -2.269 -4.229 -5.519 -8.061 -9.496 -10.294 C -13.118 -12.34 -17.61 -13.22 -22.018 -13.216 C -22.453 -13.216 -22.878 -13.207 -23.304 -13.191 C -27.98 -13.003 -31.51 -11.603 -35.616 -8.964 C -35.907 -8.776 -36.191 -8.584 -36.475 -8.385 C -35.363 -7.694 -34.336 -6.901 -33.4 -6.003 C -29.529 -2.307 -27.379 3.071 -27.391 9.414 C -27.432 16.879 -31.036 21.763 -35.249 24.354 C -39.458 26.976 -44.098 27.627 -47.019 27.639 C -47.75 27.639 -48.375 27.599 -48.928 27.512 L -50.707 27.225 L -50.707 15.313 C -50.701 10.229 -50.464 4.81 -48.333 -.283 C -47.31 -2.715 -45.912 -4.956 -44.23 -6.955 C -45.694 -7.263 -47.276 -7.423 -48.966 -7.426 C -52.961 -7.413 -55.865 -6.376 -58.235 -4.818 L -58.141 35.311 L -27.975 35.311 C -24.062 35.281 -21.397 35.362 -17.829 34.73 C -14.257 34.096 -10.811 32.885 -7.819 31.008 C -4.828 29.13 -2.265 26.563 -.44 23.563 C 1.388 20.563 2.499 17.103 2.804 13.584 C 2.866 12.904 2.895 12.217 2.895 11.527 C 2.895 7.533 1.886 3.522 0 0 M -39.888 -5.459 C -41.812 -3.469 -43.38 -1.158 -44.436 1.356 C -46.196 5.52 -46.485 10.365 -46.479 15.313 L -46.479 23.402 C -44.143 23.324 -40.466 22.658 -37.5 20.772 C -34.295 18.697 -31.741 15.531 -31.62 9.393 C -31.63 3.986 -33.379 -.116 -36.325 -2.951 C -37.354 -3.938 -38.544 -4.778 -39.888 -5.459 M -34.512 96.144 C -34.386 96.144 -34.252 96.144 -34.117 96.141 C -22.392 95.961 -15.66 89.292 -12.882 82.385 C -14.488 83.259 -16.183 83.974 -17.921 84.57 C -20.277 85.38 -22.734 85.729 -25.171 85.729 C -27.353 85.729 -29.521 85.45 -31.597 84.966 C -36.125 83.916 -40.281 81.49 -43.431 78.08 C -46.418 74.862 -48.597 71.523 -49.636 67.027 C -50.664 62.621 -50.705 58.206 -50.707 53.977 L -50.707 47.899 L -41.707 47.899 C -37.767 47.912 -29.396 48.175 -21.729 51.737 C -14.934 54.823 -8.69 60.959 -7.397 71.292 C -5.694 68.271 -4.715 64.829 -4.611 61.375 C -4.607 61.172 -4.602 60.961 -4.602 60.751 C -4.602 57.561 -5.341 54.363 -6.771 51.539 C -8.292 48.531 -10.626 45.911 -13.433 44.009 C -16.235 42.103 -19.551 40.884 -22.992 40.276 C -26.609 39.639 -27.834 39.545 -29.588 39.538 L -58.13 39.538 L -58.03 81.887 C -54.608 86.979 -46.986 96.19 -34.512 96.144 M -11.378 75.5 C -11.459 64.146 -16.887 58.767 -23.517 55.569 C -30.165 52.45 -38.015 52.116 -41.707 52.128 L -46.479 52.128 L -46.479 53.977 C -46.482 58.172 -46.412 62.261 -45.519 66.06 C -44.634 69.764 -43.049 72.235 -40.323 75.212 C -37.761 77.992 -34.323 79.999 -30.642 80.849 C -28.849 81.266 -26.994 81.501 -25.171 81.501 C -23.136 81.501 -21.144 81.21 -19.295 80.572 C -16.27 79.528 -13.615 78.184 -11.422 76.295 C -11.401 76.028 -11.387 75.763 -11.378 75.5 M 7.017 13.948 C 6.653 18.109 5.35 22.179 3.171 25.762 C .991 29.344 -2.035 32.369 -5.572 34.59 C -8.447 36.392 -11.604 37.61 -14.837 38.394 C -13.53 38.994 -12.262 39.691 -11.058 40.51 C -7.668 42.812 -4.861 45.954 -3.001 49.628 C -1.256 53.077 -.377 56.915 -.374 60.751 C -.374 61.005 -.38 61.25 -.385 61.492 C -.545 66.753 -2.357 71.898 -5.494 76.103 C -6.083 76.896 -6.718 77.63 -7.388 78.309 C -8.885 88.325 -17.439 100.105 -34.04 100.367 C -34.186 100.37 -34.346 100.373 -34.512 100.373 C -50.36 100.323 -59.096 88.097 -62.285 83.108 L -62.196 83.053 L -62.254 83.053 L -62.467 -6.973 L -62.364 -6.973 L -62.397 -7.014 L -62.4 -7.014 C -59.17 -9.692 -54.76 -11.671 -48.966 -11.652 C -46.035 -11.654 -43.28 -11.229 -40.782 -10.393 C -39.869 -11.158 -38.909 -11.867 -37.91 -12.513 C -33.462 -15.411 -28.968 -17.224 -23.462 -17.418 C -22.98 -17.435 -22.5 -17.442 -22.018 -17.442 C -17.068 -17.437 -11.892 -16.489 -7.42 -13.979 C -2.52 -11.207 1.168 -6.75 3.722 -1.996 C 5.946 2.149 7.119 6.83 7.122 11.527 C 7.122 12.336 7.087 13.147 7.017 13.948 " fill="#ffffff"></path>
</g>
<text fill="#404041" xml:space="preserve" transform="matrix(1 0 -0 1 0 301)" font-size="19.9851" font-family="Lato" font-weight="bold"><tspan y="-44.0947" x="57.5977 68.309719 82.85887 93.570888 104.02309 118.21251 124.48783 139.59658 153.786 166.7963 177.12859 188.56006 192.41718 196.27429 207.48593 222.03508 237.14382 252.07268 258.348 273.45674 287.90596 291.76307 295.62019 306.83183 322.79994 335.89018 339.74729 343.6044 359.5725 373.66206 387.85148 398.18379 404.4591 416.35026 429.4205 433.27763 437.13475 449.02589 460.45738 474.1671 487.55714 502.66587 514.1093 527.1996 531.0567 534.9138 547.4045 560.49478 571.9262 582.88607 597.07546 610.1657 622.89627 634.78738 641.0627 657.03079">SUSTAINABLE  FUNDING  FOR  QUALITY  TEACHER  PREPARATION</tspan></text>
<path transform="matrix(1,0,0,-1,205.5273,136.5039)" d="M 0 0 L 29.669 0 L 29.669 -86.042 L 54.129 -86.042 L 54.129 0 L 83.799 0 L 83.799 19.394 L 0 19.394 Z " fill="#404041"></path>
<clipPath id="cp1">
<path transform="matrix(1,0,0,-1,0,301)" d="M 0 301 L 738 301 L 738 0 L 0 0 Z "></path>
</clipPath>
<g clip-path="url(#cp1)">
<path transform="matrix(1,0,0,-1,218.5542,66.691898)" d="M 0 0 L 6.309 0 C 9.463 0 11.734 .753 13.12 2.258 C 14.506 3.764 15.199 5.866 15.199 8.567 C 15.199 9.762 15.02 10.849 14.662 11.829 C 14.303 12.809 13.759 13.651 13.03 14.356 C 12.301 15.061 11.381 15.605 10.27 15.988 C 9.159 16.37 7.838 16.562 6.309 16.562 L 0 16.562 Z M 0 -9.141 L 0 -26.599 L -12.116 -26.599 L -12.116 25.63 L 6.309 25.63 C 9.989 25.63 13.15 25.194 15.791 24.322 C 18.431 23.449 20.606 22.249 22.315 20.719 C 24.023 19.19 25.284 17.386 26.097 15.307 C 26.909 13.227 27.315 10.98 27.315 8.567 C 27.315 5.962 26.897 3.572 26.061 1.398 C 25.224 -.777 23.946 -2.641 22.225 -4.194 C 20.504 -5.748 18.323 -6.96 15.683 -7.833 C 13.042 -8.706 9.917 -9.141 6.309 -9.141 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,264.2939,65.6167)" d="M 0 0 L 4.875 0 C 6.524 0 7.928 .209 9.087 .627 C 10.246 1.045 11.196 1.625 11.937 2.366 C 12.678 3.106 13.215 3.973 13.55 4.965 C 13.885 5.957 14.052 7.026 14.052 8.173 C 14.052 10.467 13.305 12.26 11.812 13.55 C 10.318 14.841 8.006 15.486 4.875 15.486 L 0 15.486 Z M 0 -8.353 L 0 -27.674 L -12.116 -27.674 L -12.116 24.555 L 4.875 24.555 C 8.651 24.555 11.871 24.167 14.536 23.39 C 17.201 22.613 19.375 21.532 21.06 20.146 C 22.745 18.76 23.97 17.123 24.734 15.235 C 25.499 13.347 25.882 11.292 25.882 9.069 C 25.882 7.372 25.654 5.771 25.201 4.266 C 24.747 2.76 24.071 1.368 23.175 .09 C 22.279 -1.189 21.18 -2.33 19.877 -3.333 C 18.574 -4.337 17.075 -5.162 15.378 -5.807 C 16.19 -6.214 16.95 -6.716 17.655 -7.313 C 18.359 -7.911 18.975 -8.639 19.501 -9.5 L 30.613 -27.674 L 19.644 -27.674 C 17.613 -27.674 16.155 -26.909 15.271 -25.38 L 6.596 -10.216 C 6.213 -9.548 5.766 -9.069 5.251 -8.782 C 4.738 -8.496 4.015 -8.353 3.083 -8.353 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,333.478,41.061494)" d="M 0 0 L 0 -9.32 L -21.437 -9.32 L -21.437 -21.508 L -5.019 -21.508 L -5.019 -30.47 L -21.437 -30.47 L -21.437 -42.909 L 0 -42.909 L 0 -52.229 L -33.625 -52.229 L -33.625 0 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,352.4766,66.691898)" d="M 0 0 L 6.309 0 C 9.463 0 11.733 .753 13.12 2.258 C 14.506 3.764 15.199 5.866 15.199 8.567 C 15.199 9.762 15.02 10.849 14.661 11.829 C 14.303 12.809 13.759 13.651 13.03 14.356 C 12.301 15.061 11.381 15.605 10.27 15.988 C 9.159 16.37 7.838 16.562 6.309 16.562 L 0 16.562 Z M 0 -9.141 L 0 -26.599 L -12.117 -26.599 L -12.117 25.63 L 6.309 25.63 C 9.989 25.63 13.149 25.194 15.791 24.322 C 18.431 23.449 20.605 22.249 22.314 20.719 C 24.022 19.19 25.284 17.386 26.097 15.307 C 26.908 13.227 27.315 10.98 27.315 8.567 C 27.315 5.962 26.896 3.572 26.061 1.398 C 25.224 -.777 23.945 -2.641 22.225 -4.194 C 20.505 -5.748 18.323 -6.96 15.683 -7.833 C 13.042 -8.706 9.917 -9.141 6.309 -9.141 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,395.0625,73.3237)" d="M 0 0 L 14.267 0 L 9.464 14.303 C 9.152 15.211 8.788 16.28 8.37 17.511 C 7.951 18.742 7.539 20.074 7.133 21.508 C 6.751 20.05 6.356 18.7 5.95 17.458 C 5.544 16.214 5.162 15.139 4.804 14.231 Z M 33.553 -19.967 L 24.16 -19.967 C 23.108 -19.967 22.243 -19.722 21.562 -19.232 C 20.881 -18.742 20.408 -18.115 20.146 -17.35 L 17.062 -8.245 L -2.797 -8.245 L -5.879 -17.35 C -6.118 -18.02 -6.584 -18.623 -7.277 -19.16 C -7.971 -19.698 -8.818 -19.967 -9.822 -19.967 L -19.286 -19.967 L .932 32.262 L 13.335 32.262 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,444.9619,65.6167)" d="M 0 0 L 4.875 0 C 6.523 0 7.928 .209 9.087 .627 C 10.245 1.045 11.195 1.625 11.937 2.366 C 12.677 3.106 13.215 3.973 13.549 4.965 C 13.884 5.957 14.052 7.026 14.052 8.173 C 14.052 10.467 13.304 12.26 11.811 13.55 C 10.316 14.841 8.005 15.486 4.875 15.486 L 0 15.486 Z M 0 -8.353 L 0 -27.674 L -12.117 -27.674 L -12.117 24.555 L 4.875 24.555 C 8.65 24.555 11.87 24.167 14.535 23.39 C 17.199 22.613 19.375 21.532 21.06 20.146 C 22.744 18.76 23.969 17.123 24.734 15.235 C 25.498 13.347 25.881 11.292 25.881 9.069 C 25.881 7.372 25.653 5.771 25.2 4.266 C 24.745 2.76 24.07 1.368 23.175 .09 C 22.278 -1.189 21.179 -2.33 19.876 -3.333 C 18.573 -4.337 17.074 -5.162 15.378 -5.807 C 16.19 -6.214 16.949 -6.716 17.654 -7.313 C 18.358 -7.911 18.974 -8.639 19.5 -9.5 L 30.612 -27.674 L 19.644 -27.674 C 17.612 -27.674 16.154 -26.909 15.271 -25.38 L 6.595 -10.216 C 6.213 -9.548 5.765 -9.069 5.251 -8.782 C 4.736 -8.496 4.015 -8.353 3.082 -8.353 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,514.1455,41.061494)" d="M 0 0 L 0 -9.32 L -21.437 -9.32 L -21.437 -21.508 L -5.019 -21.508 L -5.019 -30.47 L -21.437 -30.47 L -21.437 -42.909 L 0 -42.909 L 0 -52.229 L -33.624 -52.229 L -33.624 0 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,556.0137,67.1582)" d="M 0 0 C 0 2.581 -.334 4.911 -1.003 6.99 C -1.672 9.069 -2.635 10.832 -3.889 12.278 C -5.145 13.724 -6.679 14.834 -8.495 15.612 C -10.313 16.388 -12.379 16.776 -14.696 16.776 L -22.798 16.776 L -22.798 -16.812 L -14.696 -16.812 C -12.379 -16.812 -10.313 -16.424 -8.495 -15.647 C -6.679 -14.871 -5.145 -13.759 -3.889 -12.313 C -2.635 -10.868 -1.672 -9.105 -1.003 -7.026 C -.334 -4.947 0 -2.605 0 0 M 12.404 0 C 12.404 -3.776 11.752 -7.259 10.45 -10.449 C 9.146 -13.64 7.312 -16.4 4.947 -18.73 C 2.582 -21.06 -.27 -22.876 -3.602 -24.179 C -6.936 -25.481 -10.634 -26.132 -14.696 -26.132 L -34.985 -26.132 L -34.985 26.097 L -14.696 26.097 C -10.634 26.097 -6.936 25.439 -3.602 24.125 C -.27 22.811 2.582 20.994 4.947 18.676 C 7.312 16.358 9.146 13.604 10.45 10.414 C 11.752 7.223 12.404 3.751 12.404 0 " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,625.9863,41.061494)" d="M 0 0 L 0 -9.607 L -14.697 -9.607 L -14.697 -52.229 L -26.813 -52.229 L -26.813 -9.607 L -41.511 -9.607 L -41.511 0 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,667.999,67.1582)" d="M 0 0 C 0 2.581 -.335 4.905 -1.004 6.972 C -1.673 9.039 -2.635 10.79 -3.889 12.224 C -5.144 13.658 -6.68 14.757 -8.495 15.522 C -10.312 16.286 -12.38 16.669 -14.697 16.669 C -17.039 16.669 -19.124 16.286 -20.952 15.522 C -22.781 14.757 -24.322 13.658 -25.577 12.224 C -26.832 10.79 -27.794 9.039 -28.462 6.972 C -29.132 4.905 -29.467 2.581 -29.467 0 C -29.467 -2.605 -29.132 -4.941 -28.462 -7.008 C -27.794 -9.075 -26.832 -10.826 -25.577 -12.26 C -24.322 -13.693 -22.781 -14.787 -20.952 -15.54 C -19.124 -16.292 -17.039 -16.669 -14.697 -16.669 C -12.38 -16.669 -10.312 -16.292 -8.495 -15.54 C -6.68 -14.787 -5.144 -13.693 -3.889 -12.26 C -2.635 -10.826 -1.673 -9.075 -1.004 -7.008 C -.335 -4.941 0 -2.605 0 0 M 12.403 0 C 12.403 -3.776 11.752 -7.289 10.449 -10.539 C 9.146 -13.789 7.313 -16.615 4.947 -19.017 C 2.581 -21.418 -.269 -23.3 -3.603 -24.663 C -6.937 -26.025 -10.635 -26.706 -14.697 -26.706 C -18.76 -26.706 -22.464 -26.025 -25.81 -24.663 C -29.156 -23.3 -32.018 -21.418 -34.396 -19.017 C -36.773 -16.615 -38.613 -13.789 -39.915 -10.539 C -41.218 -7.289 -41.869 -3.776 -41.869 0 C -41.869 3.776 -41.218 7.289 -39.915 10.539 C -38.613 13.789 -36.773 16.609 -34.396 18.999 C -32.018 21.389 -29.156 23.265 -25.81 24.627 C -22.464 25.989 -18.76 26.67 -14.697 26.67 C -10.635 26.67 -6.937 25.983 -3.603 24.609 C -.269 23.235 2.581 21.353 4.947 18.963 C 7.313 16.573 9.146 13.753 10.449 10.503 C 11.752 7.253 12.403 3.751 12.403 0 " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,299.4575,222.5469)" d="M 0 0 L 67.878 0 L 67.878 18.815 L 24.604 18.815 L 24.604 43.926 L 57.748 43.926 L 57.748 62.019 L 24.604 62.019 L 24.604 86.622 L 67.878 86.622 L 67.878 105.436 L 0 105.436 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,411.6211,182.2393)" d="M 0 0 L 9.697 28.729 C 10.421 30.562 11.192 32.732 12.014 35.241 C 12.833 37.75 13.629 40.476 14.401 43.419 C 15.221 40.524 16.053 37.835 16.896 35.351 C 17.741 32.865 18.478 30.707 19.104 28.873 L 28.802 0 Z M 1.882 65.128 L -38.932 -40.308 L -19.827 -40.308 C -17.802 -40.308 -16.09 -39.765 -14.689 -38.679 C -13.291 -37.594 -12.351 -36.376 -11.867 -35.024 L -5.644 -16.645 L 34.446 -16.645 L 40.67 -35.024 C 41.2 -36.568 42.153 -37.836 43.528 -38.824 C 44.903 -39.813 46.651 -40.308 48.774 -40.308 L 67.734 -40.308 L 26.92 65.128 Z " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,510.8711,145.2241)" d="M 0 0 C 2.629 2.918 5.776 5.162 9.443 6.73 C 13.109 8.297 17.162 9.082 21.601 9.082 C 24.157 9.082 26.388 8.888 28.295 8.503 C 30.2 8.116 31.864 7.646 33.288 7.092 C 34.71 6.537 35.939 5.934 36.979 5.283 C 38.016 4.631 38.968 4.027 39.837 3.474 C 40.705 2.918 41.525 2.448 42.297 2.063 C 43.068 1.676 43.89 1.483 44.758 1.483 C 46.061 1.483 47.073 1.761 47.797 2.316 C 48.521 2.87 49.146 3.485 49.679 4.161 L 57.929 15.233 C 55.95 17.307 53.683 19.201 51.126 20.914 C 48.568 22.625 45.771 24.098 42.73 25.328 C 39.692 26.559 36.423 27.522 32.926 28.223 C 29.428 28.921 25.7 29.272 21.745 29.272 C 13.592 29.272 6.138 27.944 -.615 25.292 C -7.37 22.638 -13.171 18.924 -18.019 14.147 C -22.868 9.371 -26.644 3.69 -29.345 -2.895 C -32.047 -9.479 -33.396 -16.706 -33.396 -24.567 C -33.396 -32.288 -32.216 -39.438 -29.851 -46.024 C -27.488 -52.609 -24.098 -58.303 -19.684 -63.103 C -15.27 -67.903 -9.891 -71.667 -3.546 -74.392 C 2.797 -77.119 9.974 -78.479 17.982 -78.479 C 26.714 -78.479 34.276 -77.069 40.669 -74.248 C 47.062 -71.425 52.38 -67.24 56.625 -61.691 L 46.929 -51.488 C 46.396 -50.958 45.843 -50.583 45.265 -50.366 C 44.686 -50.149 44.105 -50.041 43.527 -50.041 C 42.804 -50.041 42.104 -50.197 41.429 -50.511 C 40.753 -50.825 40.126 -51.224 39.547 -51.706 C 38.101 -52.96 36.664 -54.009 35.241 -54.853 C 33.818 -55.697 32.322 -56.385 30.755 -56.916 C 29.187 -57.446 27.486 -57.819 25.653 -58.038 C 23.819 -58.254 21.793 -58.362 19.574 -58.362 C 15.714 -58.362 12.096 -57.615 8.72 -56.12 C 5.343 -54.625 2.388 -52.441 -.145 -49.57 C -2.678 -46.7 -4.681 -43.167 -6.151 -38.969 C -7.623 -34.771 -8.358 -29.972 -8.358 -24.567 C -8.358 -19.406 -7.623 -14.751 -6.151 -10.602 C -4.681 -6.454 -2.63 -2.919 0 0 " fill="#404041"></path>
<path transform="matrix(1,0,0,-1,646.0684,117.1104)" d="M 0 0 L 0 -44.061 L -42.83 -44.061 L -42.83 0 L -67.428 0 L -67.428 -105.412 L -42.83 -105.412 L -42.83 -60.846 L 0 -60.846 L 0 -105.412 L 24.599 -105.412 L 24.599 0 Z " fill="#404041"></path>
</g>
</g>
</g>
</svg>

            <h1>P-12 Preparation Partnership Map</h1>
          </div>
          <div class="geocoder-container">
            <div id="geocoder" class="geocoder"></div>
            <div id="filters"><span>Filter</span></div>
          </div>
        </div>
        <div id="map-legend">
          <div class="map-legend__icons">
            <div id="map-legend__preparation-program">
              <div id="preparation-program__icon"></div><span>Preparation Program <span id="preparation-program__count"></span></span>
            </div>
            <div id="map-legend__school">
              <div id="school__icon"></div><span>School <span id="school__count"></span></span>
            </div>
          </div>
          <div id="click-hint">Click a preparation program to see its partner schools.</div>
        </div>
        <div id="filter-explanations"><b>Current filter:</b> <span id="filter-explanations__explanation">All Preparation programs and schools in all locales that are part of the Prepared to Teach Learning Network.</span></div>
        <div id="filter-results-by">
          <div id="filter-results-by__title"><b>Filter results by</b></div>
          <svg id="filter-results-by__close" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
<g>
  <g>
    <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
      L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
      c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
      l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
      L284.286,256.002z"></path>
  </g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>
          <form id="filter-form">
            <div>
              <div class="custom-control custom-checkbox">
                <input class="custom-control-input" id="prepared-to-teach-learning-network" onchange="updateFilters(this)" name="global:ptt-network" type="checkbox" value="Prepared To Teach Learning Network" autocomplete="off" checked>
                <label class="custom-control-label" for="prepared-to-teach-learning-network">Prepared To Teach Learning Network</label>
              </div>
            </div>
            <div>
              <div class="custom-control custom-checkbox">
                <input class="custom-control-input" id="locales-all" onchange="toggleAll(this)" name="locales:all" type="checkbox" value="locales:all" autocomplete="off" checked>
                <label class="custom-control-label" for="locales-all">
                  <a class="collapse-toggle" data-toggle="collapse" href="#locales__collapse" aria-expanded="false" aria-controls="locales__collapse">
                    Locales
                    <svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                    </svg>
                  </a>
                </label>
              </div>
              <div class="row">
                <div class="col">
                  <div class="collapse multi-collapse sub-contents show" id="locales__collapse">
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="urban" onchange="updateFilters(this)" name="global:locale:urban" type="checkbox" value="Urban" autocomplete="off" checked>
                      <label class="custom-control-label" for="urban">Urban</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="suburban" onchange="updateFilters(this)" name="global:locale:suburban" type="checkbox" value="suburban" autocomplete="off" checked>
                      <label class="custom-control-label" for="suburban">Suburban</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="rural" onchange="updateFilters(this)" name="global:locale:rural" type="checkbox" value="Rural" autocomplete="off" checked>
                      <label class="custom-control-label" for="rural">Rural</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="city" onchange="updateFilters(this)" name="global:locale:city" type="checkbox" value="City" autocomplete="off" checked>
                      <label class="custom-control-label" for="city">City</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="town" onchange="updateFilters(this)" name="global:locale:town" type="checkbox" value="Town" autocomplete="off" checked>
                      <label class="custom-control-label" for="town">Town</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="custom-control custom-checkbox">
                <input class="custom-control-input" id="states-all" onchange="toggleAll(this)" name="states:all" type="checkbox" value="states:all" autocomplete="off" disabled>
                <label class="custom-control-label" for="states-all">
                  <a class="collapse-toggle" data-toggle="collapse" href="#states__collapse" aria-expanded="false" aria-controls="states__collapse">
                    States
                    <svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                    </svg>
                  </a>
                </label>
              </div>
              <div class="row">
                <div class="col">
                  <div class="collapse multi-collapse sub-contents" id="states__collapse"></div>
                </div>
              </div>
            </div>
            <div>
              <div class="custom-control custom-checkbox">
                <input class="custom-control-input" id="preparation-programs-all" onchange="toggleAll(this)" name="preparation-programs:all" type="checkbox" value="preparation-programs:all" autocomplete="off" checked>
                <label class="custom-control-label" for="preparation-programs-all">
                  <a class="collapse-toggle" data-toggle="collapse" href="#preparation-programs__collapse" aria-expanded="false" aria-controls="preparation-programs__collapse">
                    Preparation Programs
                    <svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                    </svg>
                  </a>
                </label>
              </div>
              <div class="row">
                <div class="col">
                  <div class="collapse multi-collapse sub-contents show" id="preparation-programs__collapse"></div>
                </div>
              </div>
            </div>
            <div>
              <div class="custom-control custom-checkbox">
                <input class="custom-control-input" id="schools-all" onchange="toggleAll(this)" name="schools:all" type="checkbox" value="schools:all" autocomplete="off" checked>
                <label class="custom-control-label" for="schools-all">
                  <a class="collapse-toggle" data-toggle="collapse" href="#schools__collapse" aria-expanded="false" aria-controls="schools__collapse">
                    Schools
                    <svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                    </svg>
                  </a>
                </label>
              </div>
              <div class="row">
                <div class="col">
                  <div class="collapse multi-collapse sub-contents show" id="schools__collapse"></div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="Modal" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modal-title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="modal-body">
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
if (!String.prototype.includes) {
  String.prototype.includes = function(search, start) {
    'use strict';

    if (search instanceof RegExp) {
      throw TypeError('first argument must not be a RegExp');
    } 
    if (start === undefined) { start = 0; }
    return this.indexOf(search, start) !== -1;
  };
}

//var csv is the CSV file with headers
function csvToJson(csv){
    var lines=csv.split("\n");

    var result = [];

    // NOTE: If your columns contain commas in their values, you'll need
    // to deal with those before doing the next step 
    // (you might convert them to &&& or something, then covert them back later)
    // jsfiddle showing the issue https://jsfiddle.net/
    var headers=lines[0].split(";");

    for(var i=1;i<lines.length;i++){

        var obj = {};
        var currentline=lines[i].split(";");
        var licensureAreas = "";

        for(var j=0;j<headers.length;j++){
            obj[headers[j]] = currentline[j];
            if (headers[j].includes("Licensure Area ")) {
                licensureAreas += currentline[j] + ", "
            }
        }

        obj["Licensure Areas"] = licensureAreas;

        if (obj["School Name"] !== undefined || obj["IHE Name"] !== undefined) {
            result.push(obj);
        }

    }

    //return result; //JavaScript object
    return result; //JSON
}
      </script>
      <script>
function forwardGeocoder(query) {
  var matchingFeatures = [];

  allMarkers.forEach(function(marker) {
    var schoolOrUniversityName = "";
    if (marker['School Name'] !== undefined) {
      schoolOrUniversityName = marker['School Name'];
    } else if (marker['IHE Name'] !== undefined) {
      schoolOrUniversityName = marker['IHE Name'];
    }

    if (schoolOrUniversityName.toLowerCase().includes(query.toLowerCase())) {
      marker['place_name'] = schoolOrUniversityName;
      marker['center'] = [marker.Longitude, marker.Latitude];
      matchingFeatures.push({
        type: "Feature",
        properties: marker,
        place_name: schoolOrUniversityName,
        center: [marker.Longitude, marker.Latitude],
        geometry: {
          coordinates: [
            marker.Longitude,
            marker.Latitude
          ],
          type: "Point"
        }
      });
    }
  });

  return matchingFeatures;
}

function generateDetailedPopupHTML(marker) {
  var description = "<div class='container'><div class='row'>"
  var properties = marker;
  var licensureAreas = [];
  for (var key in marker) {
    if (key.includes('Licensure Area ') && marker[key]) {
      licensureAreas.push(marker[key]);
    }
  }

  if (marker["School Name"]) {
    description += "<h5><b>" + marker["School Name"] + "</b></h5>";
  }

  description += "<div class='col-sm'>";
  if (properties["PTT Network"] == "Yes") {
    description += "<b>Prepared To Teach Learning Network</b><br />";
  }
  description += "<b>Locale:</b> " + properties["Locale"] + "<br />";
  description += "<b>Size:</b> " + (properties["Size"] || properties["Type/Size"]) + "<br />";
  if (properties["Grade Level"]) {
    description += "<b>Grade Level:</b> " + properties["Grade Level"] + "<br />";
  }
  if (properties["Type"]) {
    description += "<b>Type:</b> " + properties["Type"] + "<br />";
  }
  if (properties["High-Needs School"]) {
    description += "<b>High-Needs School:</b> " + properties["High-Needs School"] + "<br />";
  }
  if (properties["Hosts Pre-Clinical Placement (Field-Placement)"]) {
    description += "<b>Hosts Pre-Clinical Placement (Field-Placement):</b> " + properties["Hosts Pre-Clinical Placement (Field-Placement)"] + "<br />";
  }
  if (properties["Hosts Culminating Clinical Placement"]) {
    description += "<b>Hosts Culminating Clinical Placement:</b> " + properties["Hosts Culminating Clinical Placement"] + "<br />";
  }
  if (properties["Hosts Culminating Year-Long Clinical Placement"]) {
    description += "<b>Hosts Culminating Year-Long Clinical Placement:</b> " + properties["Hosts Culminating Year-Long Clinical Placement"] + "<br />";
  }
  if (properties["Hosts Enrichment Program"]) {
    description += "<b>Hosts Enrichment Program:</b> " + properties["Hosts Enrichment Program"] + "<br />";
  }
  if (properties["Professional Development School (PDS Model)"]) {
    description += "<b>Professional Development School (PDS Model):</b> " + properties["Professional Development School (PDS Model)"] + "<br />";
  }
  if (properties["Year-long Residency (Any Program)"]) {
    description += "<b>Year-long Residency (Any Program):</b> " + properties["Year-long Residency (Any Program)"] + "<br />";
  }

  var universityName = properties['IHE Name'];
  // Get partners of the clicked university
  var IHEPartners = IHEPartnersDictionary[universityName] || [];

  if (IHEPartners.length > 0) {
    description += "<b>School Partners:</b><br /> <ul>";
    IHEPartners.forEach(function(IHEPartner) {
      if (IHEPartner["School Name"]) {
        description += "<li>" + IHEPartner["School Name"] + "</li>";
      }
    });
    description += "</ul></li>";
  }

  description += "<div style='margin-top: 30px'>" + (properties["Partnerships Description"] || properties["Specific Partnership Level Information for ALL IHE partners in one text box"]) + "</div>";
  description += "</div>";

  if (licensureAreas.length > 0) {
    description += "<div class='col-sm'>";
    description += "<b>Licensure Areas:</b> <ul>";
    licensureAreas.forEach(function(licensureArea) {
      description += "<li>" + licensureArea + "</li>";
    });
    description += "</ul>";
    description += "</div>";
  }

  description += "</div></div>";

  return description;
}

function zoomToMarkers(markers) {
  if (markers.length > 1) {
    var bounds = new mapboxgl.LngLatBounds();

    window.allMarkers.forEach(function(marker) {
      if (marker.Longitude && marker.Latitude) {
        bounds.extend([marker.Longitude, marker.Latitude]);
      }
    });

    // If in desktop view add padding to fit map with filters menu on left
    if (screen.width > 480) {
      map.fitBounds(bounds, { padding: 100, offset: [75, 0] });
    } else {
      map.fitBounds(bounds, { padding: 50 });
    }

  }
}

function initializeMap(schoolJson, universityJson) {
  mapboxgl.accessToken = 'pk.eyJ1IjoiY3JlYXRpdmVhbGNoZW15IiwiYSI6ImNrY3hncmZsaDAzd2Uycm1kMDMzendla2oifQ.Ipc4OYyTLjhevQR9_Y8TBA';
  window.map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/creativealchemy/ckf1yi5i420yb19oarf18bh5z',
    center: [-100.5795, 39.8283], // center of U.S.
    zoom: 4 // starting zoom
  });


  var geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    countries: 'us',
    localGeocoder: forwardGeocoder,
    placeholder: 'Search for a school/university',
    mapboxgl: mapboxgl,
    zoom: 8
  });

  document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

  // Add zoom and rotation controls to the map.
  map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

  window.popup = new mapboxgl.Popup({
    closeOnClick: false,
    closeButton: true,
  });

  // Populate with all the schools
  schoolJson.forEach(function(school) {
    // Exit early if there is no school name;
    if (school["School Name"] === undefined || school["School Name"] === null || school["School Name"] === "") {
      return;
    }

    // create a HTML element for each feature
    var el = document.createElement('div');
    el.className = 'marker marker__school';

    el.addEventListener("mouseenter", function() {
      popup.setLngLat([school.Longitude, school.Latitude])
        .setHTML(generateDetailedPopupHTML(school))
        .addTo(map);
    });

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
      .setLngLat([school.Longitude, school.Latitude])
      .addTo(map);
  });

  var createIHEPartnersDictionary = function() {
    var IHEPartnersDictionary = {};

    schoolJson.forEach(function(schoolMarker) {
      var IHEPartner1 = schoolMarker['IHE Partner 1'];
      var IHEPartner2 = schoolMarker['IHE Partner 2'];
      var IHEPartner3 = schoolMarker['IHE Partner 3'];
      var IHEPartner4 = schoolMarker['IHE Partner 4'];

      var IHEPartners = [IHEPartner1, IHEPartner2, IHEPartner3, IHEPartner4];

      IHEPartners.forEach(function(IHEPartner) {
        if (IHEPartner && schoolMarker['School Name']) {
          var schoolName = schoolMarker['School Name'];

          if (IHEPartnersDictionary[IHEPartner]) {
            IHEPartnersDictionary[IHEPartner].push(schoolMarker);
          } else {
            IHEPartnersDictionary[IHEPartner] = [schoolMarker]
          }
        }
      });
    });

    return IHEPartnersDictionary;
  }

  window.IHEPartnersDictionary = createIHEPartnersDictionary();

  // Populate with all the universitys
  universityJson.forEach(function(university) {
    // Exit early if there is no university name;
    if (university["IHE Name"] === undefined || university["IHE Name"] === null || university["IHE Name"] === "") {
      return;
    }

    // create a HTML element for each feature
    var el = document.createElement('div');
    el.dataset.toggle = 'modal';
    el.dataset.target = '#modal'
    el.className = 'marker marker__preparation-program';

    el.addEventListener("mouseenter", function() {
      popup.setLngLat([university.Longitude, university.Latitude])
        .setHTML('<h5><b>' + university["IHE Name"] + '</b></h5>')
        .addTo(map);
    });

    el.addEventListener("click", function() {
      popup.remove();

      // Clear out current markers
      var markers = document.querySelectorAll('.marker');
      for (var i = 0; i < markers.length; i++) {
        markers[i].style.display = 'none';
      }

      el.style.display = 'block';

      var universityName = university['IHE Name'];

      var titleEl = document.getElementById('modal-title');
      var bodyEl = document.getElementById('modal-body');
      titleEl.innerHTML = "<b>" + universityName + "</b>";
      bodyEl.innerHTML = generateDetailedPopupHTML(university);

      // Get partners of the clicked university
      var zoomMarkers = IHEPartnersDictionary[universityName] || [];

      zoomMarkers.forEach(function(school) {
        // Exit early if there is no school name;
        if (school["School Name"] === undefined || school["School Name"] === null || school["School Name"] === "") {
          return;
        }

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker marker__school marker__zoomed';

        el.addEventListener("mouseenter", function() {
          popup.setLngLat([school.Longitude, school.Latitude])
            .setHTML(generateDetailedPopupHTML(school))
            .addTo(map);
        });

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
          .setLngLat([school.Longitude, school.Latitude])
          .addTo(map);
      });

      zoomMarkers.push(university);

      var IHEcenter = [university.Longitude, university.Latitude];

      if (zoomMarkers.length > 1) {
        var bounds = new mapboxgl.LngLatBounds();
        zoomMarkers.forEach(function(marker) {
          bounds.extend([marker.Longitude, marker.Latitude]);
        });

        // If in desktop view add padding to fit map with filters menu on left
        if (screen.width > 480) {
          map.fitBounds(bounds, { padding: 100, offset: [75, 0] });
        } else {
          map.fitBounds(bounds, { padding: 50 });
        }

      } else if (zoomMarkers.length === 1) {
          map.flyTo({
            center: IHEcenter,
            essential: true,
            zoom: 8,
          });
      }
    });

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
      .setLngLat([university.Longitude, university.Latitude])
      .addTo(map);
  });

  map.on("click", function(e) {
    if (!e.originalEvent.target.classList.contains("marker")) {
      popup.remove();
      zoomToMarkers(window.filteredFeatures);

      var zoomedMarkers = document.querySelectorAll('.marker__zoomed');
      for (var i = 0; i < zoomedMarkers.length; i++) {
        zoomedMarkers[i].remove();
      }

      // Reverts all markers to visible
      var markers = document.querySelectorAll('.marker');
      for (var i = 0; i < markers.length; i++) {
        markers[i].style.display = 'block';
      }
    }
  });

  window.allMarkers = schoolJson.concat(universityJson);
  window.filteredFeatures = window.allMarkers.slice();

  zoomToMarkers(window.allMarkers);

  preparationCountEl = document.getElementById('preparation-program__count');
  schoolCountEl = document.getElementById('school__count');

  preparationCountEl.innerText = "(" + universityJson.length + ")";
  schoolCountEl.innerText = "(" + schoolJson.length + ")";
}

$('#filters').on('click', function() {
  $('#filter-results-by').css('display', 'block');
});

$('#filter-results-by__close').on('click', function() {
  $('#filter-results-by').css('display', 'none');
});
      </script>
      <script>
        // Fetch a csv
        fetch('schools.csv')
        .then(function(data) { return data.text() })
        .then(function(schoolCsv) {
              fetch('universities.csv')
              .then(function(data) { return data.text() })
              .then(function(universityCsv) {
                var schoolJson = csvToJson(schoolCsv);
                var universityJson = csvToJson(universityCsv);
                initializeMap(schoolJson, universityJson);
              })
            });
            </script>
      <script>
var preparationPrograms = [
  {
    name: 'type:public',
    label: 'Public',
    defaultValue: true
  },
  {
    name: 'type:private',
    label: 'Private',
    defaultValue: true
  },
  {
    name: 'size:large',
    label: 'Large',
    defaultValue: true
  },
  {
    name: 'size:medium',
    label: 'Medium',
    defaultValue: true
  },
  {
    name: 'size:small',
    label: 'Small',
    defaultValue: true
  },
  {
    name: 'full-year-clinical-placements-available',
    label: 'Full-year clinical placements available',
    secondary: true,
    defaultValue: false
  },
  {
    name: 'district-level-partnership',
    label: 'District-level partnership',
    secondary: true,
    defaultValue: false
  }
];

var schools = [
  {
    name: 'type:public',
    label: 'Public',
    defaultValue: true
  },
  {
    name: 'type:private',
    label: 'Private',
    defaultValue: true
  },
  {
    name: 'type:charter',
    label: 'Charter',
    defaultValue: true
  },
  {
    name: 'size:large',
    label: 'Large',
    defaultValue: true
  },
  {
    name: 'size:medium',
    label: 'Medium',
    defaultValue: true
  },
  {
    name: 'size:small',
    label: 'Small',
    defaultValue: true
  },
  {
    name: 'size:fringe',
    label: 'Fringe',
    defaultValue: true
  },
  {
    name: 'size:distant',
    label: 'Distant',
    defaultValue: true
  },
  {
    name: 'grade-level:elementary',
    label: 'Elementary school',
    defaultValue: true
  },
  {
    name: 'grade-level:middle',
    label: 'Middle school',
    defaultValue: true
  },
  {
    name: 'grade-level:high',
    label: 'High school',
    defaultValue: true
  },
  {
    name: 'high-needs',
    label: 'High-needs school',
    secondary: true,
    defaultValue: false
  },
  {
    name: 'hosts-pre-clinical-hours',
    label: 'Hosts pre-clinical hours',
    secondary: true,
    defaultValue: false
  },
    {
    name: 'hosts-culminating-clinical-placements',
    label: 'Hosts culminating clinical placements',
    secondary: true,
    defaultValue: false
  },
  {
    name: 'hosts-year-long-clinical-placements',
    label: 'Hosts year-long clinical placements',
    secondary: true,
    defaultValue: false
  },
  {
    name: 'hosts-enrichment-programs',
    label: 'Hosts enrichment programs',
    secondary: true,
    defaultValue: false
  },
  {
    name: 'professional-development-school',
    label: 'Professional development school',
    secondary: true,
    defaultValue: false
  },
];

var states = [
  {
    name: 'AL',
    label: 'Alabama',
    bbox: '-88.473227,30.223334,-84.88908,35.008028',
    defaultValue: false
  },
  {
    name: 'AK',
    label: 'Alaska',
    bbox: '-179.148909,51.214183,-179.77847,71.365162',
    defaultValue: false
  },
  {
    name: 'AZ',
    label: 'Arizona',
    bbox: '-114.81651,31.332177,-109.045223,37.00426',
    defaultValue: false
  },
  {
    name: 'AR',
    label: 'Arkansas',
    bbox: '-94.617919,33.004106,-89.644395,36.4996',
    defaultValue: false
  },
  {
    name: 'CA',
    label: 'California',
    bbox: '-124.409591,32.534156,-114.131211,42.009518',
    defaultValue: false
  },
  {
    name: 'CO',
    label: 'Colorado',
    bbox: '-109.060253,36.992426,-102.041524,41.003444',
    defaultValue: false
  },
  {
    name: 'CT',
    label: 'Connecticut',
    bbox: '-73.727775,40.980144,-71.786994,42.050587',
    defaultValue: false
  },
  {
    name: 'DE',
    label: 'Delaware',
    bbox: '-75.788658,38.451013,-75.048939,39.839007',
    defaultValue: false
  },
  {
    name: 'DC',
    label: 'District of Columbia',
    bbox: '-77.119759,38.791645,-76.909395,38.99511',
    defaultValue: false
  },
  {
    name: 'FL',
    label: 'Florida',
    bbox: '-87.634938,24.523096,-80.031362,31.000888',
    defaultValue: false
  },
  {
    name: 'GA',
    label: 'Georgia',
    bbox: '-85.605165,30.357851,-80.839729,35.000659',
    defaultValue: false
  },
  {
    name: 'HI',
    label: 'Hawaii',
    bbox: '-178.334698,18.910361,-154.806773,28.402123',
    defaultValue: false
  },
  {
    name: 'ID',
    label: 'Idaho',
    bbox: '-117.243027,41.988057,-111.043564,49.001146',
    defaultValue: false
  },
  {
    name: 'IL',
    label: 'Illinois',
    bbox: '-91.513079,36.970298,-87.494756,42.508481',
    defaultValue: false
  },
  {
    name: 'IN',
    label: 'Indiana',
    bbox: '-88.09776,37.771742,-84.784579,41.760592',
    defaultValue: false
  },
  {
    name: 'IA',
    label: 'Iowa',
    bbox: '-96.639704,40.375501,-90.140061,43.501196',
    defaultValue: false
  },
  {
    name: 'KS',
    label: 'Kansas',
    bbox: '-102.051744,36.993016,-94.588413,40.003162',
    defaultValue: false
  },
  {
    name: 'KY',
    label: 'Kentucky',
    bbox: '-89.571509,36.497129,-81.964971,39.147458',
    defaultValue: false
  },
  {
    name: 'LA',
    label: 'Louisiana',
    bbox: '-94.043147,28.928609,-88.817017,33.019457',
    defaultValue: false
  },
  {
     name: 'ME',
     label: 'Maine',
     bbox: '-71.083924,42.977764,-66.949895,47.459686',
    defaultValue: false
    },
  {
    name: 'MD',
    label: 'Maryland',
    bbox: '-79.487651,37.911717,-75.048939,39.723043',
    defaultValue: false
  },
  {
    name: 'MA',
    label: 'Massachusetts',
    bbox: '-73.508142,41.237964,-69.928393,42.886589',
    defaultValue: false
  },
  {
    name: 'MI',
    label:'Michigan',
    bbox: '-90.418136,41.696118,-82.413474,48.2388',
    defaultValue: false
  },
  {
    name: 'MN',
    label: 'Minnesota',
    bbox: '-97.239209,43.499356,-89.491739,49.384358',
    defaultValue: false
  },
  {
    name: 'MS',
    label: 'Mississippi',
    bbox: '-91.655009,30.173943,-88.097888,34.996052',
    defaultValue: false
  },
  {
    name: 'MO',
    label: 'Missouri',
    bbox: '-95.774704,35.995683,-89.098843,40.61364',
    defaultValue: false
  },
  {
    name: 'MT',
    label: 'Montana',
    bbox: '-116.050003,44.358221,-104.039138,49.00139',
    defaultValue: false
  },
  {
    name: 'NE',
    label: 'Nebraska',
    bbox: '-104.053514,39.999998,-95.30829,43.001708',
    defaultValue: false
  },
  {
    name: 'NV',
    label: 'Nevada',
    bbox: '-120.005746,35.001857,-114.039648,42.002207',
    defaultValue: false
  },
  {
    name: 'NH',
    label: 'New Hampshire',
    bbox: '-72.557247,42.69699,-70.610621,45.305476',
    defaultValue: false
  },
  {
    name: 'NJ',
    label: 'New Jersey',
    bbox: '-75.559614,38.928519,-73.893979,41.357423',
    defaultValue: false
  },
  {
    name: 'NM',
    label: 'New Mexico',
    bbox: '-109.050173,31.332301,-103.001964,37.000232',
    defaultValue: false
  },
  {
    name: 'NY',
    label: 'New York',
    bbox: '-79.762152,40.496103,-71.856214,45.01585',
    defaultValue: false
  },
  {
    name: 'NC',
    label: 'North Carolina',
    bbox: '-84.321869,33.842316,-75.460621,36.588117',
    defaultValue: false
  },
  {
    name: 'ND',
    label: 'North Dakota',
    bbox: '-104.0489,45.935054,-96.554507,49.000574',
    defaultValue: false
  },
  {
    name: 'OH',
    label: 'Ohio',
    bbox: '-84.820159,38.403202,-80.518693,41.977523',
    defaultValue: false
  },
  {
    name: 'OK',
    label: 'Oklahoma',
    bbox: '-103.002565,33.615833,-94.430662,37.002206',
    defaultValue: false
  },
  {
    name: 'OR',
    label: 'Oregon',
    bbox: '-124.566244,41.991794,-116.463504,46.292035',
    defaultValue: false
  },
  {
    name: 'PA',
    label: 'Pennsylvania',
    bbox: '-80.519891,39.7198,-74.689516,42.26986',
    defaultValue: false
  },
  {
    name: 'RI',
    label: 'Rhode Island',
    bbox: '-71.862772,41.146339,-71.12057,42.018798',
    defaultValue: false
  },
  {
    name: 'SC',
    label: 'South Carolina',
    bbox: '-83.35391,32.0346,-78.54203,35.215402',
    defaultValue: false
  },
  {
    name: 'SD',
    label: 'South Dakota',
    bbox: '-104.057698,42.479635,-96.436589,45.94545',
    defaultValue: false
  },
  {
    name: 'TN',
    label: 'Tennessee',
    bbox: '-90.310298,34.982972,-81.6469,36.678118',
    defaultValue: false
  },
  {
    name: 'TX',
    label: 'Texas',
    bbox: '-106.645646,25.837377,-93.508292,36.500704',
    defaultValue: false
  },
  {
    name: 'UT',
    label: 'Utah',
    bbox: '-114.052962,36.997968,-109.041058,42.001567',
    defaultValue: false
  },
  {
    name: 'VT',
    label: 'Vermont',
    bbox: '-73.43774,42.726853,-71.464555,45.016659',
    defaultValue: false
  },
  {
    name: 'VA',
    label: 'Virginia',
    bbox: '-83.675395,36.540738,-75.242266,39.466012',
    defaultValue: false
  },
  {
    name: 'WA',
    label: 'Washington',
    bbox: '-124.763068,45.543541,-116.915989,49.002494',
    defaultValue: false
  },
  {
    name: 'WV',
    label: 'West Virginia',
    bbox: '-82.644739,37.201483,-77.719519,40.638801',
    defaultValue: false
  },
  {
    name: 'WI',
    label: 'Wisconsin',
    bbox: '-92.888114,42.491983,-86.805415,47.080621',
    defaultValue: false
  },
  {
    name: 'WY',
    label: 'Wyoming',
    bbox: '-111.056888,40.994746,-104.05216,45.005904',
    defaultValue: false
  }];

var licensureAreas = [
  {
    name: 'licensure-areas:agriculture',
    label: 'Agriculture',
    defaultValue: false
  },
  {
    name: 'licensure-areas:biology-7-12',
    label: 'Biology 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:carpentry-7-12',
    label: 'Carpentry 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:chemistry-7-12',
    label: 'Chemistry 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:childhood-education-grades-1-6',
    label: 'Childhood Education (Grades 1-6)',
    defaultValue: false
  },
  {
    name: 'licensure-areas:cosmetology-barbering-7-12',
    label: 'Cosmetology/Barbering 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:deaf-and-hard-of-hearing',
    label: 'Deaf And Hard Of Hearing',
    defaultValue: false
  },
  {
    name: 'licensure-areas:early-childhood-education-birth-grade-2',
    label: 'Early Childhood Education (Birth-Grade 2)',
    defaultValue: false
  },
  {
    name: 'licensure-areas:earth-science-7-12',
    label: 'Earth Science 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:english-language-arts-7-12',
    label: 'English Language Arts 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:english-to-speakers-of-other-languages',
    label: 'English To Speakers Of Other Languages',
    defaultValue: false
  },
  {
    name: 'licensure-areas:family-and-consumer-sciences',
    label: 'Family And Consumer Sciences',
    defaultValue: false
  },
  {
    name: 'licensure-areas:french-7-12',
    label: 'French 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:health-education',
    label: 'Health Education',
    defaultValue: false
  },
  {
    name: 'licensure-areas:music',
    label: 'Music',
    defaultValue: false
  },
  {
    name: 'licensure-areas:physical-education',
    label: 'Physical Education',
    defaultValue: false
  },
  {
    name: 'licensure-areas:physics-7-12',
    label: 'Physics 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:social-studies-7-12',
    label: 'Social Studies 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:spansih-7-12',
    label: 'Spanish 7-12',
    defaultValue: false
  },
  {
    name: 'licensure-areas:speech-and-language-disabilities',
    label: 'Speech And Language Disabilities',
    defaultValue: false
  },
  {
    name: 'licensure-areas:students-with-disabilities-birth-grade-2',
    label: 'Students With Disabilities (Birth - Grade 2)',
    defaultValue: false
  },
  {
    name: 'licensure-areas:sudents-with-disabilites-grades-1-6',
    label: 'Students With Disabilities (Grades 1-6)',
    defaultValue: false
  },
  {
    name: 'licensure-areas:students-with-disabilities-grade-7-12-generalist',
    label: 'Students With Disabilities - Grades 7-12 - Generalist',
    defaultValue: false
  },
  {
    name: 'licensure-areas:technology-education',
    label: 'Technology Education',
    defaultValue: false
  },
  {
    name: 'licensure-areas:visual-arts',
    label: 'Visual Arts',
    defaultValue: false
  }
];

var populateFilters = function(group, filters) {
  var collapseId = group + "__collapse";
  var collapse = document.getElementById(collapseId);

  filters.forEach(function(filterObject) {
    var label = filterObject.label;
    var name = group + ":" + filterObject.name;
    var secondaryClass = filterObject.secondary ? "secondary" : "";

    var filterContainer = document.createElement('div');
    filterContainer.classList.add("custom-control");
    filterContainer.classList.add("custom-checkbox");
    var filterString =
        '<input class="custom-control-input ' + group + ' ' + secondaryClass + '" type="checkbox" id="' + name + '" value="' + label + '" name="' + name + '" data-bbox=' + filterObject.bbox + ' onchange="updateFilters(this)" autocomplete="off" ' + (filterObject.defaultValue ? 'checked ' : '') + '> ' +
        '<label class="custom-control-label" for="' + name + '">' + label + '</label>';
    filterContainer.innerHTML = filterString;
    collapse.appendChild(filterContainer);
  });

  if (collapseId === 'preparation-programs__collapse') {
    var licensureAreasCollapse =
      '<div>' +
        '<div class="custom-control custom-checkbox">' +
          '<input class="custom-control-input licensure-areas" id="licensure-areas-all" onchange="toggleAll(this)" name="licensure-areas:all" type="checkbox" value="licensure-areas:all" autocomplete="off">' +
          '<label class="custom-control-label" for="licensure-areas-all">' +
            '<a class="collapse-toggle" data-toggle="collapse" aria-expanded="false" aria-controls="licensure-areas__collapse" href="#licensure-areas__collapse">Licensure Areas&nbsp;</a>' +
            '<svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">' +
              '<path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>' +
            '</svg>' +
          '</label>' +
        '</div>' +
        '<div class="row">' +
          '<div class="col">' +
            '<div class="collapse multi-collapse sub-contents" id="licensure-areas__collapse"></div>' +
          '</div>' +
        '</div>' +
      '</div>'
    collapse.insertAdjacentHTML('beforeend', licensureAreasCollapse);
  }
}

populateFilters('preparation-programs', preparationPrograms);
populateFilters('schools', schools);
populateFilters('licensure-areas', licensureAreas);
populateFilters('states', states);
      </script>
      <script>
var filters = {
  "global:ptt-network": true,
  "global:locale:urban": true,
  "global:locale:suburban": true,
  "global:locale:rural": true,
  "global:locale:city": true,
  "global:locale:town": true,
  "preparation-programs:type:public": true,
  "preparation-programs:type:private": true,
  "preparation-programs:size:large": true,
  "preparation-programs:size:medium": true,
  "preparation-programs:size:small": true,
  "preparation-programs:size:fringe": true,
  "preparation-programs:size:distant": true,
  "preparation-programs:full-year-clinical-placements-available": false,
  "preparation-programs:district-level-partnership": false,
  "schools:type:public": true,
  "schools:type:private": true,
  "schools:type:charter": true,
  "schools:size:large": true,
  "schools:size:medium": true,
  "schools:size:small": true,
  "schools:size:fringe": true,
  "schools:size:distant": true,
  "schools:grade-level:elementary": true,
  "schools:grade-level:middle": true,
  "schools:grade-level:high": true,
};
var activeLicensureAreas = {};

var updateFilters = function(element) {
  // Check if all siblings are checked
  var allChecked = true;
  var container = $(element).parent().parent();
  var parentCheckbox = container.parent().parent().parent().find('input').first();

  if ($(element).hasClass('licensure-areas')) {
    container.find('input').each(function() {
      if ($(this).prop('checked') === false) {
        allChecked = false;
      }
    });
  } else {
    container.find('input:not(.licensure-areas):not(.secondary').each(function() {
      if ($(this).prop('checked') === false) {
        allChecked = false;
      }
    });
  }

  if (allChecked) {
    parentCheckbox.prop('checked', true);
  } else {
    parentCheckbox.prop('checked', false);
  }

  // update application state
  if (element.type === 'checkbox') {
    filters[element.name] = element.checked;

    if (element.name.includes('licensure-areas') && element.checked === true) {
      activeLicensureAreas[element.value] = element.checked;
    } else if (element.name.includes('licensure-areas') && element.checked === false) {
      delete activeLicensureAreas[element.value];
    }

    // If a state checkbox has been checked
    if ($(element).hasClass('states')) {
      if (element.checked) {
        // Grab the bounding box of the checked state
        var bboxString = $(element).data('bbox');
        var bboxSplit = bboxString.split(',');
        var bbox = [[bboxSplit[0], bboxSplit[1]], [bboxSplit[2], bboxSplit[3]]];

        // Set state property to its bounding box
        filters[element.name] = bbox;
      }
    }
  }

  // Filters by disqualification
  window.filteredFeatures = allMarkers.filter(function(marker) {
    // Check locales
    var foundALocaleMatch = false;
    if (
      filters["global:locale:urban"] && marker["Locale"] === "Urban" ||
      filters["global:locale:suburban"] && marker["Locale"].includes("Suburb") ||
      filters["global:locale:rural"] && marker["Locale"] === "Rural" ||
      filters["global:locale:city"] && marker["Locale"] === "City" ||
      filters["global:locale:town"] && marker["Locale"] === "Town"
    ) {
      foundALocaleMatch = true;
    }

    if (foundALocaleMatch === false) {
      return false;
    }

    if (marker["IHE Name"]) {
      // Return nothing, if everything is false
      if (
        filters["preparation-programs:type:public"] === false &&
        filters["preparation-programs:type:private"] === false &&
        filters["preparation-programs:size:large"] === false &&
        filters["preparation-programs:size:medium"] === false &&
        filters["preparation-programs:size:small"] === false
      ) {
        return false;
      }

      // For IHEs, check type
      if (
        filters["preparation-programs:type:public"] ||
        filters["preparation-programs:type:private"]
      ) {
        var foundAnIHETypeMatch = false;
        if (
          filters["preparation-programs:type:public"] && marker["Type"] === "Public" ||
          filters["preparation-programs:type:private"] && marker["Type"] === "Private"
        ) {
          foundAnIHETypeMatch = true;
        }

        if (foundAnIHETypeMatch === false) {
          return false;
        }
      }

      // For IHEs, check size
      if (
        filters["preparation-programs:size:large"] ||
        filters["preparation-programs:size:medium"] ||
        filters["preparation-programs:size:small"]
      ) {
        var foundAnIHESizeMatch = false;
        if (
          filters["preparation-programs:size:large"] && marker["Size"] === "Large" ||
          filters["preparation-programs:size:medium"] && marker["Size"] === "Mid" ||
          filters["preparation-programs:size:small"] && marker["Size"] === "Small"
        ) {
          foundAnIHESizeMatch = true;
        }

        if (foundAnIHESizeMatch === false) {
          return false;
        }
      }

      if (filters["preparation-programs:full-year-clinical-placements-available"]) {
        foundAnIHESizeMatch = false;

        if (marker["Year-long Residency (Any Program)"] === 'Yes') {
          foundAnIHESizeMatch = true;
        }

        if (foundAnIHESizeMatch === false) {
            return false;
        }
      }

      if (filters["preparation-programs:district-level-partnership"]) {
        foundAnIHESizeMatch = false;

        if (marker["District Level Partnership"] === 'Yes') {
          foundAnIHESizeMatch = true;
        }

        if (foundAnIHESizeMatch === false) {
          return false;
        }
      }
    }

    if (marker["School Name"]) {
      // Return nothing, if everything is false
      if (
        filters["schools:type:public"] === false &&
        filters["schools:type:private"] === false &&
        filters["schools:type:charter"] === false &&
        filters["schools:size:large"] === false &&
        filters["schools:size:medium"] === false &&
        filters["schools:size:small"] === false &&
        filters["schools:size:fringe"] === false &&
        filters["schools:size:distant"] === false &&
        filters["schools:grade-level:elementary"] === false &&
        filters["schools:grade-level:middle"] === false &&
        filters["schools:grade-level:high"] === false
      ) {
        return false;
      }

      // For schools, check type
      if (
        filters["schools:type:public"] ||
        filters["schools:type:private"] ||
        filters["schools:type:charter"]
      ) {
        var foundASchoolTypeMatch = false;
        if (
          filters["schools:type:public"] && marker["Type"] === "Public" ||
          filters["schools:type:private"] && marker["Type"] === "Private" ||
          filters["schools:type:charter"] && marker["Type"] === "Charter"
        ) {
          foundASchoolTypeMatch = true;
        }

        if (foundASchoolTypeMatch === false) {
          return false;
        }
      }

      // For schools, check size
      if (
        filters["schools:size:large"] ||
        filters["schools:size:medium"] ||
        filters["schools:size:small"] ||
        filters["schools:size:fringe"] ||
        filters["schools:size:distant"]
      ) {
        var foundASchoolSizeMatch = false;
        if (
          filters["schools:size:large"] && marker["Type/Size"] === "Large" ||
          filters["schools:size:medium"] && marker["Type/Size"] === "Mid" ||
          filters["schools:size:small"] && marker["Type/Size"] === "Small" ||
          filters["schools:size:fringe"] && marker["Type/Size"] === "Fringe" ||
          filters["schools:size:distant"] && marker["Type/Size"] === "Distant"
        ) {
          foundASchoolSizeMatch = true;
        }

        if (foundASchoolSizeMatch === false) {
          return false;
        }
      }

      // For schools, check grade-level
      if (
        filters["schools:grade-level:elementary"] ||
        filters["schools:grade-level:middle"] ||
        filters["schools:grade-level:high"]
      ) {
        var foundAGradeLevelMatch = false;
        if (
          filters["schools:grade-level:elementary"] && marker["Grade Level"] === "Elementary" ||
          filters["schools:grade-level:middle"] && marker["Grade Level"] === "Middle" ||
          filters["schools:grade-level:high"] && marker["Grade Level"] === "High" ||
          marker["Grade Level"] === "Other"
        ) {
          foundAGradeLevelMatch = true;
        }

        if (foundAGradeLevelMatch === false) {
          return false;
        }
      }


      // Check if school supports high-needs
      if (filters["schools:high-needs"]) {
        if (marker["High-Needs School"] === "Yes") {
          return true;
        }
      }

      // For schools, check for what they host
      if (filters["schools:hosts-pre-clinical-hours"]) {
        if (marker["Hosts Pre-Clinical Placement (Field-Placement)"] === "Yes") {
          return true;
        } else {
          return false;
        }
      }

      if (filters["schools:hosts-culminating-clinical-placements"]) {
        if (marker["Hosts Culminating Clinical Placement"] === "Yes") {
          return true;
        } else {
          return false;
        }
      }

      if (filters["schools:hosts-year-long-clinical-placements"]) {
        if (marker["Hosts Culminating Year-Long Clinical Placement"] === "Yes") {
          return true;
        } else {
          return false;
        }
      }

      if (filters["schools:hosts-enrichment-programs"]) {
        if (marker["Hosts Enrichment Program"] === "Yes") {
          return true;
        } else {
          return false;
        }
      }

      // For schools, check if it is or isn't a professional development school
      if (filters["schools:professional-development-school"]) {
        if (marker["Professional Development School (PDS Model)"] === "Yes") {
          return true;
        } else {
          return false;
        }
      }
    }

    // Check licensure areas
    if (element.name.includes("licensure-areas")) {
      var currentLicensureAreas = Object.keys(activeLicensureAreas);
      if (currentLicensureAreas.length > 0) {
        var matchedLicensureAreas = 0;
        currentLicensureAreas.forEach(function(licensureArea) {
          if (marker["Licensure Areas"] && marker["Licensure Areas"].includes(licensureArea)) {
            matchedLicensureAreas++;
          }
        });

        if (matchedLicensureAreas === currentLicensureAreas.length) {
          return true;
        } else {
          return false;
        }
      }
    }

    var foundMatchingState = false;
    var filterByStateEnabled = false;
    var stateBounds = new mapboxgl.LngLatBounds();
    var numOfCheckedStates = 0;

    for (var key in filters) {
      // If a state has been checked and it contains its bounding box
      if (key.includes('states:') && filters[key]) {
        numOfCheckedStates = numOfCheckedStates + 1;

        // Grab the bounding box of checked state
        var bbox = filters[key];
        var statesCode = key.split(':')[1];

        filterByStateEnabled = true;

        stateBounds.extend(bbox);

        // Zoom to checked state(s)
        if (numOfCheckedStates > 1) {
          map.fitBounds(stateBounds, { padding: 250, offset: [100, 0]});
        } else {
          map.fitBounds(stateBounds);
        }
      }

      var address = marker['Address/Location'] || marker['Address'];

      if (address.includes(' ' + statesCode + ' ')) {
        foundMatchingState = true;
      }
    }

    if (foundMatchingState === false && filterByStateEnabled) {
      return false;
    }

    // Check ptt-network
    if (filters["global:ptt-network"] === true) {
      if (marker["PTT Network"] === "Yes") {
        return true;
      }
    } else {
      if (marker["PTT Network"] === "Yes") {
        return false;
      }
    }

    return true;
  });

  // Clear out current markers
  var markers = document.querySelectorAll('.marker');
  for (var i = 0; i < markers.length; i++) {
    markers[i].remove();
  }

  preparationProgramsCount = 0;
  schoolCount = 0;

  filteredFeatures.forEach(function(marker) {
    // create a HTML element for each feature
    var el = document.createElement('div');

    if (marker["IHE Name"]) {
      preparationProgramsCount++;
      el.className = 'marker marker__preparation-program';
      el.dataset.toggle = 'modal';
      el.dataset.target = '#modal'

      el.addEventListener("mouseenter", function() {
        popup.setLngLat([marker.Longitude, marker.Latitude])
          .setHTML('<h5><b>' + marker["IHE Name"] + '</b></h5>')
          .addTo(map);
      });

      el.addEventListener("click", function() {
        popup.remove();

        // Clear out current markers
        var markers = document.querySelectorAll('.marker');
        for (var i = 0; i < markers.length; i++) {
          markers[i].style.display = 'none';
        }

        el.style.display = 'block';

        var universityName = marker['IHE Name'];

        var titleEl = document.getElementById('modal-title');
        var bodyEl = document.getElementById('modal-body');
        titleEl.innerHTML = "<b>" + universityName + "</b>";
        bodyEl.innerHTML = generateDetailedPopupHTML(marker);

        // Get partners of the clicked university
        var zoomMarkers = IHEPartnersDictionary[universityName] || [];

        zoomMarkers.forEach(function(school) {
          // Exit early if there is no school name;
          if (school["School Name"] === undefined || school["School Name"] === null || school["School Name"] === "") {
            return;
          }

          // create a HTML element for each feature
          var el = document.createElement('div');
          el.className = 'marker marker__school marker__zoomed';

          el.addEventListener("mouseenter", function() {
            popup.setLngLat([school.Longitude, school.Latitude])
              .setHTML(generateDetailedPopupHTML(school))
              .addTo(map);
          });

          // make a marker for each feature and add to the map
          new mapboxgl.Marker(el)
            .setLngLat([school.Longitude, school.Latitude])
            .addTo(map);
        });

        zoomMarkers.push(marker);

        var IHEcenter = [marker.Longitude, marker.Latitude];

        if (zoomMarkers.length > 1) {
          var bounds = new mapboxgl.LngLatBounds();
          zoomMarkers.forEach(function(marker) {
            bounds.extend([marker.Longitude, marker.Latitude]);
          });
          map.fitBounds(bounds, { padding: 100, offset: [75, 0] });
        } else if (zoomMarkers.length === 1) {
            map.flyTo({
              center: IHEcenter,
              essential: true,
              zoom: 8,
            });
        }
      });
    } else if (marker["School Name"]) {
      schoolCount++;
      el.className = 'marker marker__school';
      el.addEventListener("mouseenter", function() {
        popup.setLngLat([marker.Longitude, marker.Latitude])
          .setHTML(generateDetailedPopupHTML(marker))
          .addTo(map);
      });
    }

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
      .setLngLat([marker.Longitude, marker.Latitude])
      .addTo(map);
  });

  preparationCountEl = document.getElementById('preparation-program__count');
  schoolCountEl = document.getElementById('school__count');

  preparationCountEl.innerText = "(" + preparationProgramsCount + ")";
  schoolCountEl.innerText = "(" + schoolCount + ")";

  generateFilterSentence(filters);

  // Commented out because the specifications have changed: J.A
  if (filteredFeatures.length > 1) {
    var bounds = new mapboxgl.LngLatBounds();
    filteredFeatures.forEach(function(marker) {
      bounds.extend([marker.Longitude, marker.Latitude]);
    });
    map.fitBounds(bounds, { padding: 100, offset: [100, 0] });
  } else if (filteredFeatures.length === 1) {
      map.flyTo({
        center: [filteredFeatures[0].Longitude, filteredFeatures[0].Latitude],
        essential: true,
        zoom: 6,
      });
  }
}

function generateFilterSentence() {
  var sentence = "";
  var preparationProgramType = [];
  var secondaryPreparationProgramFilters = [];
  var schoolType = [];
  var secondarySchoolFilters = [];

  var locales = [];
  var partOfPTTNetwork = false;

  for (var key in filters) {
    // Preparation programs
    if (key.includes("preparation-programs:type:public") && filters[key] === true) {
      preparationProgramType.push(key.split(":")[2])
    }
    if (key.includes("preparation-programs:type:private") && filters[key] === true) {
      preparationProgramType.push(key.split(":")[2])
    }
    if (key.includes("preparation-programs:size:large") && filters[key] === true) {
      preparationProgramType.push(key.split(":")[2])
    }
    if (key.includes("preparation-programs:size:medium") && filters[key] === true) {
      preparationProgramType.push(key.split(":")[2])
    }
    if (key.includes("preparation-programs:size:small") && filters[key] === true) {
      preparationProgramType.push(key.split(":")[2])
    }

    // Preparation programs secondary filters
    if (key.includes("full-year-clinical-placements-available") && filters[key] === true) {
      secondaryPreparationProgramFilters.push("full-year clinical placements available");
    }

    if (key.includes("district-level-partnership") && filters[key] === true) {
      secondaryPreparationProgramFilters.push("district level partnerships");
    }

    // Schools
    if (key.includes("schools:type:public") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:type:private") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:type:charter") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:size:large") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:size:medium") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:size:small") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:size:distant") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("schools:size:fringe") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("grade-level:elementary") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("grade-level:middle") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }
    if (key.includes("grade-level:high") && filters[key] === true) {
      schoolType.push(key.split(":")[2])
    }

    // Schools secondary filters
    if (key.includes("high-needs") && filters[key] === true) {
      secondarySchoolFilters.push("support high needs");
    }

    if (key.includes("hosts-pre-clinical-hours") && filters[key] === true) {
      secondarySchoolFilters.push("host pre-clinical hours");
    }

    if (key.includes("hosts-culminating-clinical-placements") && filters[key] === true) {
      secondarySchoolFilters.push("host culminating clinical placements");
    }

    if (key.includes("hosts-year-long-clinical-placements") && filters[key] === true) {
      secondarySchoolFilters.push("host year long clinical placements");
    }

    if (key.includes("hosts-enrichment-programs") && filters[key] === true) {
      secondarySchoolFilters.push("host enrichment programs");
    }

    if (key.includes("professional-development-school") && filters[key] === true) {
      secondarySchoolFilters.push("support professional development");
    }

    // Locale
    if (key.includes("locale") && filters[key] === true) {
      locales.push(key.split(":")[2]);
    }

    // PTT Network
    if (key.includes("ptt-network") && filters[key] === true) {
      partOfPTTNetwork = true;
    }
  }

  if (preparationProgramType.length === 0) {
    sentence += "No preparation programs ";
  } else if (preparationProgramType.length === 5) {
    sentence += "All preparation programs ";
  } else if (preparationProgramType.length === 1) {
    sentence += preparationProgramType[0] + " preparation programs ";
  } else if (preparationProgramType.length === 2) {
    sentence += preparationProgramType.slice(0, preparationProgramType.length - 1).join(", ") + " or " + preparationProgramType[preparationProgramType.length -1] + " preparation programs ";
  } else {
    sentence += preparationProgramType.slice(0, preparationProgramType.length - 1).join(", ") + ", or " + preparationProgramType[preparationProgramType.length -1] + " preparation programs ";
  }

  if (secondaryPreparationProgramFilters.length > 0) {
    sentence += "with " + secondaryPreparationProgramFilters.join(" and ") + ", ";
  }

  if (schoolType.length === 0) {
    sentence += "and no schools ";
  } else if (schoolType.length === 11) {
    sentence += "and all schools ";
  } else if (schoolType.length === 1) {
    sentence += "and " + schoolType[0] + " schools ";
  } else if (schoolType.length === 2) {
    sentence += "and " + schoolType.slice(0, schoolType.length - 1).join(", ") + " or " + schoolType[schoolType.length -1] + " schools ";
  } else {
    sentence += "and " + schoolType.slice(0, schoolType.length - 1).join(", ") + ", or " + schoolType[schoolType.length -1] + " schools ";
  }

  if (secondarySchoolFilters.length === 2) {
    sentence += "that can " + secondarySchoolFilters.join(" and ") + " ";
  } else if (secondarySchoolFilters.length > 2) {
    sentence += "that can " + secondarySchoolFilters.slice(0, secondarySchoolFilters.length - 1).join(", ") + ", and " + secondarySchoolFilters[secondarySchoolFilters.length -1] + " ";
  } else if (secondarySchoolFilters.length > 0) {
    sentence += "that can " + secondarySchoolFilters.join(", ") + " ";
  }

  if (locales.length === 0) {
    sentence += "in " + 0 + " locales";
  } else if (locales.length === 5) {
    sentence += "in all locales";
  } else if (locales.length === 1) {
    sentence += "in " + locales[0] + " locales ";
  } else if (locales.length === 2) {
    sentence += "in " + locales.slice(0, locales.length - 1).join(", ") + " or " + locales[locales.length -1] + " locales";
  } else {
    sentence += "in " + locales.slice(0, locales.length - 1).join(", ") + ", or " + locales[locales.length -1] + " locales";
  }

  if (partOfPTTNetwork) {
    sentence += " that are part of the Prepared to Teach Learning Network"
  }

  sentence += ".";

  var capitalized = sentence.charAt(0).toUpperCase() + sentence.slice(1);
  var explanationEl = document.getElementById('filter-explanations__explanation');
  explanationEl.innerText = capitalized;
}

var toggleAll = function(element) {
  var currentCheckboxState = $(element).prop('checked');
  var checkboxChildren;
  if ($(element).hasClass('licensure-areas')) {
    checkboxChildren = $(element).parent().siblings().find('input');
  } else {
    checkboxChildren = $(element).parent().siblings().find('input:not(.licensure-areas):not(.secondary)');
  }

  if (currentCheckboxState === true) {
    checkboxChildren.prop('checked', true).change();
  } else {
    checkboxChildren.prop('checked', false).change();
  }
}
      </script>
    </body>
</html>